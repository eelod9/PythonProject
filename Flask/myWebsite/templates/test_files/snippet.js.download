(()=>{var e={397:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ERROR_LIMIT:()=>n,reportError:()=>o});class i extends Error{constructor(e,t){super(e),this.name=(null==t||t.name,this.name),this.code=null==t?void 0:t.code,this.additionalInformation=null==t?void 0:t.additionalInformation,this.handled=null!==(null==t?void 0:t.handled)&&!1,this.severity=(null==t?void 0:t.severity)||WSDKErrorSeverity.ERROR}}const n=10;let s=0,r=!1;const o=e=>{return void 0,void 0,i=function*(){var t,i;if(e.handled)return;if(!e.bypassErrorLimit&&s>=n){if(r)return;e.code="ERROR_LIMIT_EXCEEDED",r=!0}s++;const o=(1e7*Math.random()).toFixed(0).toString(),c=new URLSearchParams;c.append("use_sandbox",(null===(t=e.useSandbox)||void 0===t?void 0:t.toString())||"false"),c.append("error_id",o),c.append("partner_origin",window.location.origin),c.append("rokt_tag_id",e.tagId),c.append("severity",e.severity||"WARNING"),e.code&&c.append("code",e.code),e.integration&&c.append("integration",e.integration),e.stack&&(e.stack.length>400&&(e.stack=e.stack.substring(0,400)),c.append("stack",e.stack));const a=e.reporter?`frame-${e.reporter}`:"frame";c.append("reporter",a),e.additionalInformation=e.additionalInformation||{},e.additionalInformation.name=e.additionalInformation.name||e.name,e.additionalInformation.message=e.additionalInformation.message||e.message,c.append("additional_information",JSON.stringify(e.additionalInformation));const l=document.createElement("iframe");l.src=`https://apps.rokt.com/wsdk/reporter/index.html?${c.toString()}`,l.style.display="none";const d=new Promise((e=>{const t=i=>{var n,s,r;"Rokt.Reporter.Close"!==(null===(n=i.data)||void 0===n?void 0:n.action)&&(null===(r=null===(s=i.data)||void 0===s?void 0:s.payload)||void 0===r?void 0:r.errorId)!==o||(e(),window.removeEventListener("message",t))};window.addEventListener("message",t)}));(window.document.body||window.document.head).appendChild(l),yield d,null===(i=l.parentElement)||void 0===i||i.removeChild(l)},new((t=void 0)||(t=Promise))((function(e,n){function s(e){try{o(i.next(e))}catch(e){n(e)}}function r(e){try{o(i.throw(e))}catch(e){n(e)}}function o(i){var n;i.done?e(i.value):(n=i.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,r)}o((i=i.apply(undefined,[])).next())}));var t,i};return t})()}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}(()=>{"use strict";class e{constructor(){this.fulfilled=!1,this.rejected=!1,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})).then((e=>(this.fulfilled=!0,e)),(e=>{throw this.rejected=!0,e}))}isFulfilled(){return this.fulfilled}isPending(){return!this.isFulfilled()&&!this.isRejected()}isRejected(){return this.rejected}static resolve(t){const i=new e;return i.resolve(t),i}}const t="LAUNCHER_DUPLICATE_SELECT_PLACEMENTS",n={AttributesCapture:"ATTRIBUTES_CAPTURE",AttributesCaptureFailure:"ATTRIBUTES_CAPTURE_FAILURE",PageIdUpdated:"PAGE_ID_UPDATED",PageInstanceGuidUpdated:"PAGE_INSTANCE_GUID_UPDATED",PageVariantNameUpdated:"PAGE_VARIANT_NAME_UPDATED",SessionIdUpdated:"SESSION_ID_UPDATED"},s="userAgent",r="clientType",o="passbackconversiontrackingid",c={Default:"default",Preload:"preload"},a={OFFER_ENGAGEMENT:"OFFER_ENGAGEMENT",POSITIVE_ENGAGEMENT:"POSITIVE_ENGAGEMENT",OFFER_POSITIVE_ENGAGEMENT:"OFFER_POSITIVE_ENGAGEMENT",PLACEMENT_CLOSED:"PLACEMENT_CLOSED",PLACEMENT_COMPLETED:"PLACEMENT_COMPLETED",PLACEMENT_INTERACTIVE:"PLACEMENT_INTERACTIVE",PLACEMENT_READY:"PLACEMENT_READY",PLACEMENT_RESIZE:"PLACEMENT_RESIZE",PLACEMENT_FAILURE:"PLACEMENT_FAILURE",UPDATE_CART_ITEM_MESSAGE:"UPDATE_CART_ITEM_MESSAGE",DISPLAY_SETTINGS_SET:"DISPLAY_SETTINGS_SET"},l="[L] PUT_DISPLAY_SETTINGS",d="[L] CLOSE_PLACEMENT",h="[L] FAILED_TO_LOAD_PLUGIN",u="[L] PLUGIN_TO_PARTNER",v="[L] PLUGIN_RESIZED",_="rokt-frame-type",p="PLUGIN_FRAME_CREATED",f="Standard",m="Fulfillment",g="RoktTransactionId",S="NO_SNIPPET",b="NO_TAG_ID";class E{constructor(){this._subscribers=[]}add(e){this._subscribers.push(e)}unsubscribe(){this._subscribers.forEach((e=>e.unsubscribe()))}}const y=()=>{},w=(e=y,t=y,i=y)=>"function"!=typeof e?e:{next:e,error:t,complete:i};class I{constructor(e){this._setupFn=e}subscribe(e,t,i){const n=w(e,t,i);let s,r=!0;const o={next:e=>{r&&n.next(e)},complete:()=>{r&&(s&&s(),n.complete(),r=!1)},error:e=>{r&&(n.error(e),r=!1)}};s=this._setupFn(o),r||s&&s();const c=new E;return c.add({unsubscribe:()=>{s&&s(),r=!1}}),c}}class T extends I{constructor(){super((e=>(this._isComplete&&e.complete(),this._observers.push(e),()=>this._observers=this._observers.filter((t=>t!==e))))),this._observers=[],this._isComplete=!1}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){this._isComplete=!0;for(const e of this._observers)e.complete()}asObservable(){return new I((e=>{const t=this.subscribe(e);return()=>t.unsubscribe()}))}}class A extends T{constructor(e=-1){super(),this._buffer=[],this._error=null,this._bufferLength=e}subscribe(e,t,i){const n=w(e,t,i);let s=!0;return this._buffer.filter((e=>(e===this._error&&(s=!1),s))).forEach((e=>n.next(e))),this._error&&n.error(this._error),n.error=e=>{this._error=e,t(e)},super.subscribe(n)}next(e){this._error||this._addToBuffer(e),super.next(e)}error(e){this._error=e,this._addToBuffer(e),super.error(e)}_addToBuffer(e){-1!==this._bufferLength&&this._buffer.length===this._bufferLength?(this._buffer.shift(),this._buffer.push(e)):this._buffer.push(e)}}const R=(e,t)=>new Promise(((i,n)=>{let s;"object"==typeof t&&(s=t.defaultValue),e.subscribe((e=>s=e),(e=>n(e)),(()=>i(s)))})),P=(e,t)=>new I((i=>{const n=e=>i.next(e);return e.addEventListener(t,n),()=>e.removeEventListener(t,n)})),O=(...e)=>new I((t=>{const i=new E;let n=0;for(const s of e)i.add(s.subscribe((e=>t.next(e)),(e=>t.error(e)),(()=>{n+=1,n>=e.length&&t.complete()})));return()=>i.unsubscribe()}));function C(e,t){return new N(e,t)}class N{constructor(e,t){this._target=e,this._handler=t}subscribe(e,t,i){const n=e.next?e.next.bind(e):e,s={next:(...e)=>function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){try{yield n(...e)}catch(e){this._handler(e)}})),error:e.error?e.error.bind(e):t,complete:e.complete?e.complete.bind(e):i};return this._target.subscribe(s)}}class L{constructor(e){this.value=e,this.complete=!1,this.skip=!1}}const x=e=>(...t)=>new I((i=>{const n=e.subscribe((e=>function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){try{let n=new L(e);for(const e of t){const t=e(n);if(n=t.then?yield t:t,!0===n.skip||!0===n.complete)break}if(n.skip)return;i.next(n.value),!0===n.complete&&i.complete()}catch(e){i.error(e)}}))),(e=>i.error(e)),(()=>i.complete()));return()=>n.unsubscribe()})),k=e=>t=>(!1===e(t.value)&&(t.skip=!0),t),D=e=>t=>(e?!0===e(t.value)?t.complete=!0:t.skip=!0:t.complete=!0,t),U=e=>t=>{const i=e(t.value);return new L(i)},F=e=>e.send(),M="ERROR",j="WARNING";class G extends Error{constructor(e,t){var i,n;super(e),this.name=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:this.name,this.code=null==t?void 0:t.code,this.additionalInformation=null==t?void 0:t.additionalInformation,this.handled=null!==(n=null==t?void 0:t.handled)&&void 0!==n&&n,this.severity=(null==t?void 0:t.severity)||M}}var V=i(397);new RegExp("^\\d{4}-\\d{2}-\\d{2}((T\\d{2}:\\d{2}(:\\d{2})?)(\\.\\d{1,6})?(Z|(\\+|-)\\d{2}:\\d{2})?)?$");const W=(e=0)=>new Promise((t=>setTimeout(t,e)));function B(e,t=3,i=100,n=(()=>!0)){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){try{return yield e()}catch(e){if(t<=1||!n(e))throw e}return yield W(1*i),yield B(e,t-1,i)}))}function H(e){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(e)?parseInt(e,10):0}function $(){const e=document.body.querySelectorAll("*");return Array.from(e).filter((e=>e&&e.nodeType===Node.ELEMENT_NODE)).reduce(((e,t)=>{const i=H(document.defaultView.getComputedStyle(t).getPropertyValue("z-index")),n=H(t.style&&t.style.zIndex);return Math.max(e,i,n)}),0)}const K=(e,t={})=>{for(const[i,n]of Object.entries(t))e.style[i]=n};class z{constructor(e){this.window=e}getCookie(e){try{const t=this.window.document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]}catch(e){}}setCookie(e){try{this.window.document.cookie=this.serialize(e)}catch(e){}}serialize(e){const{name:t,path:i="/",sameSite:n,secure:s,value:r}=e;let{expires:o}=e;if(!o){const e=new Date;e.setTime(e.getTime()+31536e6),o=e}let c=`${t}=${r};expires=${o.toUTCString()};path=${i}`;return s&&(c+=";secure"),n&&(c+=`;samesite=${n}`),c}}const Y=()=>{if("undefined"==typeof window)throw new Error("NO_WINDOW");return window};class q{constructor(e,t="local"){this.window=e,this._store="session"===t?"sessionStorage":"localStorage"}getItem(e){try{const t=this.window[this._store].getItem(e);if(null===t)return;return t}catch(e){return}}setItem(e,t){try{this.window[this._store].setItem(e,t)}catch(e){}}}class J extends q{constructor(e){super(e,"local")}}const X="RoktRecogniser";class Z{constructor(e,t,i){this.cookieService=e,this.localStorageService=t,this.sameSite=i}setRecogniser(e){e.cookie&&this.cookieService.setCookie({name:X,sameSite:this.sameSite,secure:!0,value:e.cookie}),e.localStorage&&this.localStorageService.setItem(X,e.localStorage)}getRecogniser(){return{cookie:this.cookieService.getCookie(X),localStorage:this.localStorageService.getItem(X)}}}class Q extends Z{constructor(e,t){super(e,t,"lax")}}function ee(){return window.crypto||window.msCrypto}function te(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}function ie(e){return new Promise(((t,i)=>{const n=function(e){if(window.TextEncoder)return(new TextEncoder).encode(e);const t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}(e),s=ee().subtle.digest("SHA-256",n);s.then?s.then((e=>{t(te(e))}),i):(s.oncomplete=e=>{const i=e.target.result;t(te(i))},s.onerror=e=>{i(e)})}))}var ne=function(e,t,i){if(i||2===arguments.length)for(var n,s=0,r=t.length;s<r;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},se=function(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"},re=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},oe=function(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"},ce=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ae=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},le=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,de=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],he=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ue(e){var t=function(e){return""!==e&&de.reduce((function(t,i){var n=i[0],s=i[1];if(t)return t;var r=s.exec(e);return!!r&&[n,r]}),!1)}(e);if(!t)return null;var i=t[0],n=t[1];if("searchbot"===i)return new ce;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<3&&(s=ne(ne([],s,!0),function(e){for(var t=[],i=0;i<e;i++)t.push("0");return t}(3-s.length),!0)):s=[];var r=s.join("."),o=function(e){for(var t=0,i=he.length;t<i;t++){var n=he[t],s=n[0];if(n[1].exec(e))return s}return null}(e),c=le.exec(e);return c&&c[1]?new oe(i,r,o,c[1]):new se(i,r,o)}function ve(e){return function(e){return e?ue(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ae:"undefined"!=typeof navigator?ue(navigator.userAgent):"undefined"!=typeof process&&process.version?new re(process.version.slice(1)):null}(e)}function _e(e=5){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length;for(let s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*n));return t}class pe extends Error{constructor(e,t){var i,n;super(e),this.name=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:this.name,this.code=null==t?void 0:t.code,this.additionalInformation=null==t?void 0:t.additionalInformation,this.handled=null!==(n=null==t?void 0:t.handled)&&void 0!==n&&n}}class fe{constructor(e){this.ID=e.ID,this.eventType=e.eventType,this.body=e.body||{},this.headers=e.headers||{},this.hasError=e.hasError||!1,this.isResponse=!!e.isResponse}}var me=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class ge{constructor(e){var t;this.options=e,this.id=this.options.id||_e(10),this.alias=this.options.alias||"No Alias",this.connection=this.options.connection,this.timeoutDuration=null!==(t=this.options.timeoutDuration)&&void 0!==t?t:1e4,this.interceptors=[]}addInterceptor(e){this.interceptors.push(e)}send(e,{body:t,headers:i={}}={}){return me(this,void 0,void 0,(function*(){const n=this.runInterceptors(this.createRequest(e,t,i)),s=new Promise(((t,i)=>me(this,void 0,void 0,(function*(){let s=!1;const r=setTimeout((()=>{s||(i(new pe(`Request timed out for ${e}`,{code:"REQUEST_TIMEOUT_ERROR"})),s=!0)}),this.timeoutDuration);x(this.connection.onMessage)(D((e=>e.ID===n.ID))).subscribe((n=>{if(s)return;if(clearTimeout(r),!n)return void i(new pe(`Wrong request format for ${e}`,{code:"REQUEST_FORMAT_ERROR"}));const o=this.runInterceptors(n);!0===o.hasError?i(o.body):t(o)}))}))));return this.connection.send(n),s}))}runInterceptors(e){const t=(e=>{const t=new WeakMap,i=e=>{if(!e||"object"!=typeof e)return e;let n;const s=Array.isArray(e)?[]:{},r=Object.getPrototypeOf(s);t.set(e,s);for(const o in e)r[o]||(n=e[o],n&&"object"==typeof n?t.get(n)?s[o]=t.get(n):s[o]=i(n):s[o]=n);return s};return i(e)})(e);for(const e of this.interceptors)e(t);return t}createRequest(e,t,i){return new fe({ID:_e(10),eventType:e,body:t,headers:Object.assign({"sender-alias":this.alias,"sender-id":this.id},i)})}}class Se{constructor(){this.middleware=[],this.handlers={}}getHandlers(){const e={};for(const[t,i]of Object.entries(this.handlers))e[t]=[...this.middleware,...i];return e}use(e){this.middleware.push(e)}on(e,...t){this.handlers[e]=t}}class be{constructor(e,t){this.connection=e,this.event=t,this.data={},this.isSent=!1,this.responseHeaders={}}getHeaders(){return this.event.headers}getEvent(){return this.event.eventType}getContext(e){return this.data[e]}setResponseHeader(e,t){this.responseHeaders[e]=t}setContext(e,t){this.data[e]=t}getBody(){return this.event.body}setBody(e){this.event.body=e}sendError(e){this.validate(e),e instanceof Error&&(e=this.convertErrorToObject(e));const t=new fe({ID:this.event.ID,eventType:this.event.eventType,body:e,headers:this.responseHeaders,hasError:!0,isResponse:!0});this.connection.send(t),this.isSent=!0}send(e){this.validate(e);const t=new fe({ID:this.event.ID,eventType:this.event.eventType,body:e,headers:this.responseHeaders,isResponse:!0});this.connection.send(t),this.isSent=!0}hasSent(){return this.isSent}validate(e){if(!0===this.isSent)throw{name:"HandlerContext.RESPONSE_ALREADY_SENT",message:"HandlerContext: Response already sent.",code:"RESPONSE_ALREADY_SENT",additionalInformation:{response:e}}}convertErrorToObject(e){return{message:e.message,name:e.name,stack:e.stack,code:e.code,handled:e.handled,additionalInformation:e.additionalInformation}}}var Ee=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class ye{constructor(e){this.options=e,this.onMessage=e=>t=>((e,...t)=>Ee(void 0,void 0,void 0,(function*(){const i=e;let n=!1;const[s,r]=function(e){const t=[];return[e.filter((e=>!(e.length>1&&(t.push(e),1)))),t]}(t),o=(e,t)=>Ee(void 0,void 0,void 0,(function*(){if(!r.length)throw t;for(const i of r)yield i(e,t)}));for(const e of s)try{yield e(i)}catch(e){n=!0,yield o(i,e);break}n||i.hasSent()||(yield o(i,new Error(`Context: Response never sent for ${i.getEvent()}`)))})))(new be(this.connection,t),...this.middleware,...e),this.connection=this.options.connection,this.subscription=new E,this.handlers=[],this.middleware=[]}use(e){if(e instanceof Se){const t=e.getHandlers();for(const[e,i]of Object.entries(t))this.on(e,...i)}else this.middleware.push(e)}on(e,...t){if(this.handlers.includes(e))throw new Error("HandlerExists");this.handlers.push(e);const i=x(this.connection.onMessage)(k((t=>t.eventType===e)));this.subscription.add(i.subscribe(this.onMessage(t)))}close(){this.subscription.unsubscribe()}}var we=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Ie{constructor(e,t){this.transmitter=e,this.router=t}eject(){return{transmitter:this.transmitter,router:this.router}}addInterceptor(e){return we(this,void 0,void 0,(function*(){this.transmitter.addInterceptor(e)}))}send(e,t={}){return we(this,void 0,void 0,(function*(){return this.transmitter.send(e,t)}))}use(e){return we(this,void 0,void 0,(function*(){this.router.use(e)}))}on(e,...t){return we(this,void 0,void 0,(function*(){this.router.on(e,...t)}))}close(){return we(this,void 0,void 0,(function*(){this.router.close()}))}}var Te=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Ae{constructor(){this.hasConnected=!1,this.transmitter=new e,this.router=new e}setEngine(e){const{router:t,transmitter:i}=e.eject();this.router.resolve(t),this.transmitter.resolve(i),this.hasConnected=!0}setRouter(e){this.router.resolve(e)}setTransmitter(e){this.transmitter.resolve(e)}addInterceptor(e){return Te(this,void 0,void 0,(function*(){(yield this.transmitter.promise).addInterceptor(e)}))}send(e,t={}){return Te(this,void 0,void 0,(function*(){return(yield this.transmitter.promise).send(e,t)}))}use(e){return Te(this,void 0,void 0,(function*(){(yield this.router.promise).use(e)}))}on(e,...t){return Te(this,void 0,void 0,(function*(){(yield this.router.promise).on(e,...t)}))}close(){return Te(this,void 0,void 0,(function*(){(yield this.router.promise).close()}))}}const Re="ERROR_SENT",Pe=(e,t)=>{!e.hasSent()&&t&&(e.sendError(t),((e,t)=>{e.setContext(Re,!0)})(e))},Oe="[C] ERROR",Ce=e=>{if(!e.isResponse&&e.body instanceof Error){const t=e.body;e.body={name:t.name,message:t.message,stack:t.stack,code:t.code,additionalInformation:t.additionalInformation,handled:t.handled,level:t.level}}},Ne="rokt-controller-frame",Le="name",xe="initTimestamp",ke="launcherInstanceId",De="noFunctional",Ue="noTargeting",Fe="doNotShareOrSell",Me="sandbox",je="sessionId",Ge="tagId",Ve="customHeaders",We="integrationType",Be="integration",He="url",$e="sessionRecogniser",Ke="serviceUrlOverride",ze="launcherVersion";class Ye{constructor(e,t){this.type=e,this.payload=t}}const qe="LINK_SENDING_DATA",Je="LINK_CLIENT_READY_FOR_PORT",Xe="LINK_HOST_PORT_TRANSFER",Ze="LINK_LISTENING";class Qe{constructor(e){this.port=e,this.onEvent=P(this.port,"message");const t=x(this.onEvent)(D((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===Ze})));this.onReady=R(t).then((()=>{})),this.onMessage=x(this.onEvent)(k((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===qe})),U((e=>e.data.payload))),this.port.start()}send(e){this.dispatch(e)}dispatch(e){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){yield this.onReady;const t=new Ye(qe,e);this.port.postMessage(t)}))}}var et=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))},tt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class it{constructor(e){this.options=e,this.onConnectionSubject=new T,this.connections={},this.handshakeFilter=e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===Je&&e.data.payload.ID===(this.options.ID||80)},this.handshake=e=>tt(this,void 0,void 0,(function*(){const t=_e(20),i=new this.options.channelConstructor,{port1:n,port2:s}=i,r=new Qe(n);e.source&&(e.source.postMessage(new Ye(Xe),this.options.targetOrigin,[s]),yield r.onReady,this.connections[t]=r,this.onConnectionSubject.next(r),n.postMessage(new Ye(Ze)))})),this.onConnection=this.onConnectionSubject.asObservable();const t=P(this.options.selfEventSource,"message");this.onPostMessage=x(t)(k(this.handshakeFilter)).subscribe(this.handshake)}destroy(){this.onPostMessage.unsubscribe()}connect(e){return tt(this,void 0,void 0,(function*(){const t=yield(({target:e,targetID:t=80,targetOrigin:i="*",selfEventSource:n,retryTimeout:s=1e3})=>et(void 0,void 0,void 0,(function*(){const r=P(n,"message"),o=x(r)(D((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===Xe}))),c=R(o);let a;setTimeout((()=>et(void 0,void 0,void 0,(function*(){for(;void 0===a;)e.postMessage(new Ye(Je,{ID:t}),i),yield W(s)}))),0);const l=yield c;a=l.ports[0];const d=new Qe(a);return a.postMessage(new Ye(Ze)),d})))({target:e.target,targetOrigin:this.options.targetOrigin||"*",selfEventSource:this.options.selfEventSource});return this.onConnectionSubject.next(t),t}))}}function nt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{return(("y"===e?8:0)^(t=new Uint8Array(1),ee().getRandomValues(t))[0]&15>>("y"===e?2:0)).toString(16);var t}))}function st(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}Object.create,Object.create;const rt="__rokt-launcher__";let ot;const ct={NoElementToPlacePlugin:"NoElementToPlacePlugin"};function at(e){const t=/url|\\|&/i;return Object.entries(e).reduce(((e,[i,n])=>(t.test(n)||(e[i]=n),e)),{})}class lt{constructor(e,t,i){this.services=e,this.pluginDetails=t,this.onResizeSubject$=new T,this.usingAutoResize=!1,this.attributeSet=!1,this.url=i?`${i}/wsdk/plugin-runtime/index.html`:this.services.urls.PLUGIN_RUNTIME_URL,this.element=((e={},...t)=>{const i=document.createElement(e.tag||"div");e.id&&(i.id=e.id),e.className&&(i.classList.value=e.className),e.cssText&&(i.style.cssText=e.cssText),e.styles&&K(i,e.styles),e.innerText&&(i.innerText=e.innerText),e.events&&((e,t={})=>{for(const[i,n]of Object.entries(t))e[i]=n})(i,e.events),e.attributes&&((e,t={})=>{for(const[i,n]of Object.entries(t))e.setAttribute(i,n)})(i,e.attributes),e.title&&(i.title=e.title);for(const e of t)"string"==typeof e?i.appendChild(document.createTextNode(e)):i.appendChild(e);return i})({tag:"iframe",styles:{border:0,width:"1px",minWidth:"100%",boxSizing:"border-box",display:"block"},id:`rokt-placement-${this.pluginDetails.pluginInstanceId}`,title:"Rokt placement",attributes:{[_]:"plugin-runtime"}}),this.onLoaded=new Promise((e=>this.element.onload=()=>e()))}getElement(){return this.element}setSandbox(e=[]){if(!0===this.attributeSet)throw new Error("Can only set attributes once");for(const t of["allow-scripts","allow-same-origin",...e])this.element.sandbox.add(t);this.attributeSet=!0}resetStyles(){this.element.removeAttribute("style")}removeStyles(e=[]){for(const t of e)this.element.style.removeProperty(t)}setStyles(e={}){K(this.element,e)}setSize(e,t){!1!==this.usingAutoResize&&(this.setStyles({height:`${e}px`,width:`${t}px`}),this.onResizeSubject$.next({height:e.toString(),width:t.toString()}))}setFullscreen(){const e=this.services.window.document.body;this.originalOverflowValue=e.style.overflow,e.style.overflow="hidden"}useAutoResizer(){this.usingAutoResize=!0}insert(e,t="child",i="append"){let n;switch(this.element.name=this.pluginDetails.configuration,this.element.src=this.url,`${t}-${i}`){case"sibling-prepend":n="beforebegin";break;case"child-prepend":n="afterbegin";break;case"sibling-append":n="afterend";break;default:n="beforeend"}e.insertAdjacentElement(n,this.element);const s=e=>{e.persisted&&(this.close(),window.removeEventListener("pageshow",s))};window.addEventListener("pageshow",s)}close(){var e;null===(e=this.element.parentNode)||void 0===e||e.removeChild(this.element),this.onResizeSubject$.complete(),"string"==typeof this.originalOverflowValue&&(this.services.window.document.body.style.overflow=this.originalOverflowValue)}onLoad(){return this.onLoaded}onClose(){return st(this,void 0,void 0,(function*(){var e;yield this.onLoaded,yield(e=this.element,new Promise((t=>{const i=new MutationObserver((n=>{n.forEach((n=>{const s=Array.from(n.removedNodes),r=s.indexOf(e)>-1,o=s.some((t=>t.contains&&t.contains(e)));(r||o)&&(i.disconnect(),t())}))}));i.observe(document.body,{subtree:!0,childList:!0})})))}))}onResize(){return this.onResizeSubject$.asObservable()}}class dt{constructor(t,i,n,s=new T,r,o){this._details=t,this._services=i,this._catchWrapSubscriber=n,this._internalEvents$=s,this._serviceUrlOverride=o,this.handleClose=()=>{this.sendToPartner({event:a.PLACEMENT_CLOSED,body:{}}),this._internalEvents$.complete()},this._frame=r||this.createFrame(),this._displayResolver=new e,this.setupHandlers(),this._frame.onResize().subscribe((e=>{this.sendToPartner({event:a.PLACEMENT_RESIZE,body:e})}))}getElement(){return this._frame.getElement()}getAlias(){var e;return null!==(e=this._details.alias)&&void 0!==e?e:""}on(e){const{placementsStream:t}=this._services,i=x(t.on(this._details.pluginInstanceId,u))(U((e=>e.getBody())));return this._catchWrapSubscriber(x(O(i,this._internalEvents$))(k((t=>"*"===e||t.event===e)),U((e=>({body:e.body,event:e.event,placement:this})))),(e=>{throw e.code="LAUNCHER_PLACEMENT_EVENT_PARTNER_CALLBACK_ERROR",this._services.logger.raiseWarning(e),e}))}send(e,t){return st(this,void 0,void 0,(function*(){const{placementsStream:i}=this._services;yield i.send(this._details.pluginInstanceId,e,t)}))}place(e){return st(this,void 0,void 0,(function*(){const{metricsService:t,controllerService:i,logger:n}=this._services;try{this._frame.setStyles({display:"none"});const n=yield B((()=>Promise.resolve(e||((e="")=>{const t=(i=e)?i.replace(/([\#\.])([0-9])/gi,"$1\\3$2 "):i;var i;if(!t)return window.document.body;const n=window.document.querySelector(t);if(!n)throw new Error(ct.NoElementToPlacePlugin);return n})(this._details.targetElementSelector))),50,100);t.triggerPluginFrameCreated(this._details.alias||"",this._details.pluginInstanceId),this._frame.insert(n,this._details.targetElementRelation||void 0,this._details.targetElementPosition||void 0),yield this._frame.onLoad(),this._frame.onClose().then(this.handleClose),this.sendToPartner({event:a.PLACEMENT_READY,body:{}}),yield i.framePlaced(this._details.pluginInstanceId)}catch(e){throw e.code="LAUNCHER_FAILED_TO_PLACE_PLUGIN",e.additionalInformation={placementId:this.getAlias()},n.raiseWarning(e),this._displayResolver.resolve(e),e}}))}remove(){return st(this,void 0,void 0,(function*(){return this._frame.close()}))}onClose(){return st(this,void 0,void 0,(function*(){return this._frame.onClose()}))}onDisplay(){return st(this,void 0,void 0,(function*(){const e=yield this._displayResolver.promise;if(e)throw e}))}setupHandlers(){const{placementsStream:e}=this._services;e.on(this._details.pluginInstanceId,l).subscribe((e=>st(this,void 0,void 0,(function*(){yield(({pluginRuntimeFrame:e,internalEvents$:t})=>i=>st(void 0,void 0,void 0,(function*(){const{sandbox:n,css:s,outerCss:r,applyHighestZIndex:o,autoresize:c,preset:l,title:d}=i.getBody();c&&e.useAutoResizer(),"DisplayPreset.FULLSCREEN"===l&&e.setFullscreen(),n&&e.setSandbox(n),s&&e.setStyles(at(s)),r&&e.setStyles(at(r)),d&&(e.getElement().title=d),o&&e.setStyles({zIndex:$()+1}),e.removeStyles(["display"]),t.next({event:a.DISPLAY_SETTINGS_SET,body:void 0}),i.send()})))({pluginRuntimeFrame:this._frame,internalEvents$:this._internalEvents$})(e),this._displayResolver.resolve()})))),e.on(this._details.pluginInstanceId,v).subscribe((({pluginRuntimeFrame:e})=>t=>st(void 0,void 0,void 0,(function*(){const{height:i,width:n}=t.getBody();e.setSize(i,n),t.send()})))({pluginRuntimeFrame:this._frame})),e.on(this._details.pluginInstanceId,d).subscribe((e=>{this._frame.close(),e.send()})),e.on(this._details.pluginInstanceId,h).subscribe((e=>{this._displayResolver.resolve(new Error("Placement failed to load")),e.send()}))}createFrame(){return new lt(this._services,this._details,this._serviceUrlOverride)}sendToPartner(e){this._internalEvents$.next(e)}}class ht{constructor(e){this.controller=e,this._bus=new T,this.middleware=()=>e=>this._bus.next(e)}on(e,t){return x(this._bus)(k((i=>(e=>e.getHeaders()["plugin-instance-id"])(i)===e&&i.getEvent()===t)))}send(e,t,i){return st(this,void 0,void 0,(function*(){yield this.controller.send("[P] PARTNER_TO_PLUGIN",{body:{event:t,body:i},headers:{"placement-id":e}})}))}}class ut{constructor(e){this._placements=e}placeAll(){return st(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.place()));yield Promise.all(e)}))}removeAll(){return st(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.remove()));yield Promise.all(e)}))}getAll(){return this._placements}on(e){const t=this._mapAll((t=>t.on(e)));return O(...t)}onDisplay(){return st(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.onDisplay()));yield Promise.all(e)}))}send(e,t){return st(this,void 0,void 0,(function*(){const i=this._mapAll((i=>i.send(e,t)));yield Promise.all(i)}))}_mapAll(e){const t=[];for(const i of this._placements)t.push(e(i));return t}}class vt{constructor(e,t,i){this._controllerService=i,this.context=e,this.placements=new ut(t)}setAttributes(e){return st(this,void 0,void 0,(function*(){yield this._controllerService.setAttributes(e)}))}}const _t=e=>e.querySelectorAll("[rokt-frame-type]");class pt{constructor(){this.fulfillmentAttributes={}}setFulfillmentAttributes(e){this.fulfillmentAttributes=this.filterAttributes(e)}getFulfillmentAttributes(){return this.fulfillmentAttributes}getHashedFulfillmentAttributes(){return st(this,void 0,void 0,(function*(){const e=Object.keys(this.fulfillmentAttributes);return 0===e.length?Promise.resolve({}):new Promise(((t,i)=>{const n=e.map((e=>ie(`${this.fulfillmentAttributes[e].value}`.trim().toLowerCase())));Promise.all(n).then((i=>{const n=i.reduce(((t,i,n)=>{const s=`widget-${e[n]}sha256hex`;return t[s]={type:m,name:s,value:i},t}),{});t(n)}),i)}))}))}filterAttributes(e){return e?((e,t)=>{const i={};for(const t of Object.keys(e)){const s=e[t];(n=s).type===m&&void 0!==n.value&&null!==n.value&&""!==n.value&&(i[t]=s)}var n;return i})(e):{}}}const ft=e=>!e||"object"!=typeof e||e.constructor!==Object;class mt{constructor(e,t,i,n,s,r){this.window=e,this.controllerConnection=t,this.fulfillmentAttributeService=i,this.sessionService=n,this.eventsService=s,this.referralService=r}selectPlacements(e,t){return st(this,void 0,void 0,(function*(){const i={attributes:yield this.processAttributes(e),pageInstanceId:this.sessionService.pageInstanceId,pageIdentifier:t,url:this.window.location.href};try{const e=yield this.controllerConnection.send("[C] SELECT_PLACEMENTS",{body:i});return this.eventsService.emit(n.AttributesCapture),e.body}catch(e){throw this.eventsService.emit(n.AttributesCaptureFailure),e}}))}placementPlaced(e){return st(this,void 0,void 0,(function*(){yield this.controllerConnection.send("[C] PLACEMENT_PLACED",{body:{id:e}})}))}framePlaced(e){return st(this,void 0,void 0,(function*(){yield this.controllerConnection.send("[C] FRAME_LOAD_END",{body:{id:e}})}))}setAttributes(e){return st(this,void 0,void 0,(function*(){try{yield this.controllerConnection.send("[C] SET_ATTRIBUTES",{body:{pageInstanceId:this.sessionService.pageInstanceId,attributes:e}})}catch(e){throw this.eventsService.emit(n.AttributesCaptureFailure),e}}))}processAttributes(e){return st(this,void 0,void 0,(function*(){const t=Object.assign({},e),i={},n={};for(const[e,s]of Object.entries(t))(s||!1===s||0===s)&&(ft(s)?n[e]={name:e,type:f,value:s}:s.type===f?n[s.name]=s:s.type===m&&(i[s.name]=s));this.fulfillmentAttributeService.setFulfillmentAttributes(i);const c=yield this.fulfillmentAttributeService.getHashedFulfillmentAttributes(),a=Object.assign(Object.assign({},n),c);if(a.userAgent||(a.userAgent={name:s,type:f,value:this.window.navigator.userAgent}),!a.clientType){const e=function(e){const t=ve(void 0),i=t?t.os:null;if(null!==i)switch(i){case"Amazon OS":case"Android OS":case"BlackBerry OS":case"iOS":case"Windows Mobile":return"MobileWeb";default:return"DesktopWeb"}}();e&&(a.clientType={name:r,type:f,value:e})}if(!a.passbackconversiontrackingid){const e=this.referralService.getReferralId();e&&(a.passbackconversiontrackingid={name:o,type:f,value:e})}return a}))}}class gt extends Ae{constructor(t,i){super(),this._errorReporter=t,this.constants=i,this._CONNECTION_TIMEOUT=13e3,this._connectionPromise=new e,this._setupCompletePromise=new e,this._link=(({targetOrigin:e,ID:t=80,window:i=Y()})=>new it({targetOrigin:e,ID:t,selfEventSource:i,channelConstructor:i.MessageChannel}))({targetOrigin:"*"}),this._link.onConnection.subscribe((e=>{if(this._connectionError){const e=new G("",{code:"LAUNCHER_REJECT_LATE_CONTROLLER_CONNECTION",severity:M});this._errorReporter(e)}else{try{const s=new Ie(new ge(i={connection:e,alias:"Launcher",timeoutDuration:15e3}),new ye(i));s.use((e=>t=>{t.setResponseHeader("origin",e.location.origin),t.setResponseHeader("host",e.location.host),t.setResponseHeader("href",e.location.href),t.setResponseHeader("pathname",e.location.pathname)})(window)),s.use(Pe),s.use((n=this,(e,t)=>{t&&e.hasSent()&&!(e=>e.getContext(Re))(e)&&n.send(Oe,{body:t})})),s.addInterceptor((e=>t=>{t.isResponse||(t.headers=Object.assign(Object.assign({},t.headers),{host:e.location.host,origin:e.location.origin,href:e.location.href,pathname:e.location.pathname}))})(window)),s.addInterceptor((t=this.constants.VERSION,e=>{e.isResponse||(e.headers=Object.assign(Object.assign({},e.headers),{"launcher-version":t}))})),s.addInterceptor(Ce),this.setEngine(s),s.on("[L] CONTROLLER_SETUP_COMPLETE",F,(()=>this._setupCompletePromise.resolve())),this._connectionPromise.resolve()}catch(e){throw e.code="LAUNCHER_CONTROLLER_HANDLER_SETUP",e.severity=M,this._errorReporter(e),e}var t,i}var n}))}onConnection(){return st(this,void 0,void 0,(function*(){if(yield this._connectionPromise.promise,this._connectionError)throw this._connectionError}))}onSetupComplete(){return st(this,void 0,void 0,(function*(){yield this._setupCompletePromise.promise}))}connect(e){return st(this,void 0,void 0,(function*(){const t=W(this._CONNECTION_TIMEOUT).then((()=>{throw new G("",{code:"LAUNCHER_CONTROLLER_CONNECTION_TIMEOUT",severity:M})})),i=this._link.connect({target:e}).catch((()=>{throw new G("",{code:"LAUNCHER_CONTROLLER_CONNECTION_SETUP",severity:M})}));try{yield Promise.race([t,i])}catch(e){this._connectionError=e,this._connectionPromise.resolve(),this._errorReporter(e)}}))}}class St{constructor(e,t,i,n,s,r){this._sessionService=e,this._urls=t,this._window=i,this._constants=n,this._recogniserAccessor=s,this._initOptions=r,this._controllerFrame=this._window.document.createElement("iframe"),this._controllerFrame.id=Ne,this._controllerFrame.name=this._createControllerName(),this._controllerFrame.title="No content",this._controllerFrame.sandbox.add("allow-scripts"),this._controllerFrame.sandbox.add("allow-same-origin"),this._controllerFrame.style.display="none",this._controllerFrame.setAttribute("aria-hidden","true"),this._controllerFrame.setAttribute(_,"controller"),r.serviceUrlOverride?this._controllerFrame.src=`${r.serviceUrlOverride}/wsdk/controller/index.html`:this._controllerFrame.src=this._urls.CONTROLLER_URL}append(){return st(this,void 0,void 0,(function*(){const e=this._window.document.body||this._window.document.head,t=new Promise((e=>this._controllerFrame.onload=e));e.appendChild(this._controllerFrame),yield t}))}getWindow(){if(!this._controllerFrame.contentWindow)throw new Error("Tried to get controller frame before it was loaded");return this._controllerFrame.contentWindow}_createControllerName(){var e,t,i,n,s;const r=new URLSearchParams;return[[Le,Ne],[ze,this._constants.VERSION],[$e,JSON.stringify(this._recogniserAccessor.getRecogniser())],[xe,null===(e=this._sessionService.initTimestamp)||void 0===e?void 0:e.toISOString()],[ke,this._sessionService.launcherInstanceId],[De,null===(t=this._sessionService.noFunctional)||void 0===t?void 0:t.toString()],[Ue,null===(i=this._sessionService.noTargeting)||void 0===i?void 0:i.toString()],[Fe,null===(n=this._sessionService.doNotShareOrSell)||void 0===n?void 0:n.toString()],[Me,null===(s=this._sessionService.sandbox)||void 0===s?void 0:s.toString()],[Ge,this._sessionService.tagId],[We,this._sessionService.integrationType],[je,this._sessionService.sessionId],[Ve,JSON.stringify(this._sessionService.customHeaders)],[He,this._window.location.href],[Be,this._initOptions.integrationName],[Ke,this._initOptions.serviceUrlOverride]].forEach((e=>{const[t,i]=e;void 0!==i&&""!==i&&r.append(t,i)})),r.toString()}}class bt{constructor(){this._subject=new T,this._observable=this._subject.asObservable()}on(e){return x(this._observable)(k((({event:t})=>e===t||"*"===e)))}emit(e,t){this._subject.next({event:e,body:t})}}class Et{constructor(e,t,i="Unspecified"){this._errorReporter=e,this._controllerConnection=t,this._integrationName=i}log(e){return st(this,void 0,void 0,(function*(){yield this._controllerConnection.send("[C] LOG",{body:e})}))}raiseError(e){return st(this,void 0,void 0,(function*(){e.severity=M,yield this.raiseIssue(e)}))}raiseWarning(e){return st(this,void 0,void 0,(function*(){e.severity=j,yield this.raiseIssue(e)}))}raiseIssue(e){return st(this,void 0,void 0,(function*(){if(!this._controllerConnection.hasConnected)return this._errorReporter(e);try{const t=e.severity||M;yield this._controllerConnection.send(Oe,{body:{additionalInformation:e.additionalInformation,code:e.code,level:t,integration:e.integration||this._integrationName,message:e.message||"Launcher error raised.",name:e.name||"LauncherError",reporter:"WSDK",severity:t,stack:e.stack,handled:e.handled}})}catch(t){this._errorReporter(e)}}))}}class yt{constructor(e,t,i,n="Unspecified"){this._integrationName=n,this._controllerConnection=e,this._windowRef=t,this._sessionService=i}trigger(e,t=!1){return st(this,void 0,void 0,(function*(){try{yield this._controllerConnection.send("[C] PUT_METRIC_EVENT",{body:Object.assign(Object.assign({},e),{timestamp:e.timestamp.toISOString(),launcherInstanceId:this._sessionService.launcherInstanceId,pageInstanceId:t&&this._sessionService.pageInstanceId||e.pageInstanceId||void 0,data:Object.assign({},e.data)})})}catch(e){}}))}triggerPageStart(e){var t,i;return st(this,void 0,void 0,(function*(){const n=null===(i=null===(t=this._windowRef.performance)||void 0===t?void 0:t.timing)||void 0===i?void 0:i.responseStart;(e||n&&!(Date.now()-n>36e5))&&(yield this.trigger({type:"PAGE_START",timestamp:e||new Date(n)},!0))}))}triggerIntegrationStart(e=new Date){return st(this,void 0,void 0,(function*(){const t={integrationName:this._integrationName};yield Promise.all([this.trigger({type:"INTEGRATION_START",timestamp:e,data:t},!0),this.trigger({type:"ROKT_START",timestamp:e},!0)])}))}triggerLauncherStart(e){return st(this,void 0,void 0,(function*(){yield this.trigger({type:"LAUNCHER_START",timestamp:e||new Date})}))}triggerControllerFrameCreated(){return st(this,void 0,void 0,(function*(){yield this.trigger({type:"CONTROLLER_FRAME_CREATED",timestamp:new Date})}))}triggerSelectionStart(e,t){return st(this,void 0,void 0,(function*(){yield this.trigger({type:"SELECTION_START",timestamp:t,pageInstanceId:e})}))}triggerSelectionEnd(e){return st(this,void 0,void 0,(function*(){yield this.trigger({type:"SELECTION_END",timestamp:new Date,pageInstanceId:e})}))}triggerPluginFrameCreated(e,t){return st(this,void 0,void 0,(function*(){const i={type:p,timestamp:new Date,pluginAlias:e,pluginInstanceId:t};yield this.trigger(Object.assign(Object.assign({},i),{type:p}),!0),yield this.trigger(Object.assign(Object.assign({},i),{type:"PLUGIN_RUNTIME_FRAME_CREATED"}),!0)}))}}class wt{constructor(e,t){this._urls=e,this._windowRef=t}preloadPluginRuntime(){return st(this,void 0,void 0,(function*(){return this._createPreloadIframe(this._urls.PLUGIN_RUNTIME_URL)}))}preloadWidgetPlugin(){return st(this,void 0,void 0,(function*(){return this._createPreloadIframe(this._urls.WIDGET_PLUGIN_URL)}))}_createPreloadIframe(e){return st(this,void 0,void 0,(function*(){const t=new URLSearchParams;t.append("integration_type","preload"),t.append("init_timestamp",String((new Date).getTime()));const i=t.toString(),n=this._windowRef.document.createElement("iframe");n.style.display="none",n.name=i,n.src=e;const s=new Promise((e=>n.onload=e)),r=this._windowRef.document.body||this._windowRef.document.head;r.appendChild(n),yield s,n.onload=null,r.removeChild(n)}))}}class It{constructor(e){const t=e[e.INTEGRATION_WSDK_TARGET];this.CONTROLLER_URL=`${t}/wsdk/controller/index.html`,this.PLUGIN_RUNTIME_URL=`${t}/wsdk/plugin-runtime/index.html`,this.WIDGET_PLUGIN_URL=`${t}/wsdk/plugins/widget/index.html`}}class Tt{constructor(e){this.initTimestamp=e.initTimestamp||new Date,this.integrationType=e.integrationType||c.Default,this.noFunctional=e.noDeviceId||e.noFunctional||!1,this.noTargeting=e.noDeviceId||e.noTargeting||!1,this.doNotShareOrSell=e.doNotShareOrSell||!1,this.sandbox=e.sandbox||!1,this.sessionId=e.sessionId,this.tagId=e.tagId,this.pageInstanceId=e.pageInstanceId||this.getNewPageInstanceGuid(),this.launcherInstanceId=nt(),this.customHeaders=e.customHeaders}resetPageId(){this.pageInstanceId=this.getNewPageInstanceGuid()}getNewPageInstanceGuid(){return nt()}}class At{constructor(e,t){this._storage=e,this._cookie=t}getReferralId(){var e,t;return null!==(t=null!==(e=this._storage.getItem("rtid"))&&void 0!==e?e:this._storage.getItem(g))&&void 0!==t?t:this._cookie.getCookie(g)}}class Rt{constructor(e,t){this.initOptions=e,this.window=Y(),this.constants=(()=>{let e;return e=void 0==={VERSION:"3.6.0",ORIGIN_ROKT_APPS:"https://apps.rokt.com",ORIGIN_ROKT_WSDK:"https://wsdk.rokt.com",INTEGRATION_WSDK_TARGET:"ORIGIN_ROKT_APPS"}?{VERSION:ot||"",ORIGIN_ROKT_APPS:"",ORIGIN_ROKT_WSDK:"",INTEGRATION_WSDK_TARGET:"ORIGIN_ROKT_APPS"}:{VERSION:"3.6.0",ORIGIN_ROKT_APPS:"https://apps.rokt.com",ORIGIN_ROKT_WSDK:"https://wsdk.rokt.com",INTEGRATION_WSDK_TARGET:"ORIGIN_ROKT_APPS"},e.VERSION=ot||e.VERSION,e})(),this.controllerConnection=new gt(t,this.constants),this.logger=new Et(t,this.controllerConnection,this.initOptions.integrationName),this.eventsService=new bt,this.cookieService=new z(this.window),this.localStorageService=new J(this.window),this.recogniserAccessor=new Q(this.cookieService,this.localStorageService),this.referralService=new At(this.localStorageService,this.cookieService),this.urls=new It(this.constants),this.preloadService=new wt(this.urls,this.window),this.fulfillmentAttributeService=new pt,this.sessionService=new Tt(this.initOptions),this.controllerFrame=new St(this.sessionService,this.urls,this.window,this.constants,this.recogniserAccessor,this.initOptions),this.controllerService=new mt(this.window,this.controllerConnection,this.fulfillmentAttributeService,this.sessionService,this.eventsService,this.referralService),this.metricsService=new yt(this.controllerConnection,this.window,this.sessionService,this.initOptions.integrationName),this.placementsStream=new ht(this.controllerConnection)}}class Pt{constructor(e){var t,i;const s=new Date;var r;this._initOptions=e,this._initOptions.integrationVersion&&(r=this._initOptions.integrationVersion,ot=r),this.fromController=new T;const o=((e,t=!1,i="Unspecified")=>n=>{(0,V.reportError)({tagId:e,useSandbox:t,integration:i,reporter:n.reporter||"WSDK",message:n.message,name:n.name,stack:n.stack,additionalInformation:n.additionalInformation,code:n.code,severity:n.severity})})(e.tagId,e.sandbox,this._initOptions.integrationName);try{this.services=new Rt(this._initOptions,o);const{controllerConnection:e,controllerFrame:r,eventsService:c,metricsService:a,placementsStream:_,preloadService:p,sessionService:f}=this.services;this._initOptions.sandbox&&this.services.window.console.warn("ROKT: 'sandbox' mode enabled. ROKT Placements shown will not generate revenue. If this is not intended then please omit the 'sandbox' flag when initializing ROKT's SDK."),r.append().then((()=>e.connect(r.getWindow()))).catch((e=>{throw e.code=e.code||"LAUNCHER_CONTROLLER_CONNECTION",o(e),e})),a.triggerControllerFrameCreated(),this._initOptions.skipPreload||(p.preloadPluginRuntime(),p.preloadWidgetPlugin()),a.triggerPageStart(null!==(t=this._initOptions.pageInitTimestamp)&&void 0!==t?t:void 0),a.triggerIntegrationStart(null!==(i=this._initOptions.initTimestamp)&&void 0!==i?i:s),a.triggerLauncherStart(s),e.on(l,_.middleware()),e.on(d,_.middleware()),e.on(h,_.middleware()),e.on(v,_.middleware()),e.on(u,F,_.middleware()),e.on("[L] GET_FULFILLMENT_ATTRIBUTES",(({fulfillmentAttributeService:e})=>t=>{const i=e.getFulfillmentAttributes();t.send({fulfillmentAttributes:i})})(this.services)),e.on("[L] SEND_LAUNCHER_EVENT",(({eventsService:e})=>t=>{const i=t.getBody();i&&i.name&&e.emit(i.name,i.payload),t.send()})(this.services)),e.on("[L] SET_FIRST_PARTY_RECOGNISER",(({recogniserAccessor:e})=>t=>{const i=t.getBody();e.setRecogniser(i.firstPartyRecogniser),t.send()})(this.services)),e.on("[L] SET_SESSION_ID",(()=>e=>e.send())),e.on("[L] ATTRIBUTES_CAPTURE_RESULT",(({eventsService:e})=>t=>{t.getBody().isSuccess?e.emit(n.AttributesCapture):e.emit(n.AttributesCaptureFailure),t.send()})(this.services)),e.on("[L] CONTROLLER_TO_PARTNER",(e=>this.fromController.next(e.getBody())),F),e.on("[L] CREATE_PLUGIN",(e=>{var t=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}(e,[]);return e=>{const i=e.getBody();new dt(i,t,C,void 0,void 0,t.initOptions.serviceUrlOverride).place(),e.send()}})(this.services)),c.on(n.SessionIdUpdated).subscribe((e=>{f.sessionId=e.body}))}catch(e){throw e.code=e.code||"LAUNCHER_INIT",o(e),e}}on(e){const t=this.services.eventsService;return x(O(this.fromController,t.on("*")))(k((t=>"*"===e||t.event===e)))}log(e){return st(this,void 0,void 0,(function*(){const{logger:t}=this.services;yield t.log(e)}))}raiseError(e){return st(this,void 0,void 0,(function*(){const{logger:t}=this.services;yield t.raiseIssue(e)}))}ready(){return st(this,void 0,void 0,(function*(){const{controllerConnection:e}=this.services;yield e.onConnection()}))}selectPlacements({attributes:e,pageIdentifier:i}){return st(this,void 0,void 0,(function*(){const{controllerConnection:n,controllerService:s,sessionService:r,metricsService:o}=this.services;yield n.onSetupComplete();const c=new Date;if(r.pageInstanceId===this.previousPageInstanceId)throw new G(t,{code:t,severity:j});const a=yield s.selectPlacements(e,i);this.previousPageInstanceId=r.pageInstanceId;const l=a.placements.map((e=>new dt(e,this.services,C,void 0,void 0,this.services.initOptions.serviceUrlOverride))),d=new vt(a.context,l,s);return o.triggerSelectionStart(r.pageInstanceId,c),o.triggerSelectionEnd(r.pageInstanceId),d}))}destroy(){_t(window.document).forEach((e=>{var t;return null===(t=null==e?void 0:e.parentNode)||void 0===t?void 0:t.removeChild(e)})),this.services.window[rt]=void 0}changePage(e){var t;const i=new Date;this.services.sessionService.resetPageId(),this.services.metricsService.triggerPageStart(null!==(t=null==e?void 0:e.pageInitTimestamp)&&void 0!==t?t:i),this.services.metricsService.triggerIntegrationStart(i)}}const Ot=e=>st(void 0,void 0,void 0,(function*(){return window[rt]&&!window["__rokt-launcher-allow-multiple__"]||(window[rt]=Promise.resolve(new Pt(e))),window[rt]}));function Ct(){const e=ve();switch(null==e?void 0:e.name){case"chrome":return parseFloat(null==e?void 0:e.version)>=52;case"ie":case"safari":case"ios":return parseFloat(null==e?void 0:e.version)>=11;case"ios-webview":return parseFloat(null==e?void 0:e.version)>=604;default:return!0}}const Nt={HashArgumentTypeOf:"Value to be hashed must be of type string"},Lt=e=>st(void 0,void 0,void 0,(function*(){if("string"!=typeof e)throw new Error(Nt.HashArgumentTypeOf);return ie(e.trim().toLocaleLowerCase())}));var xt=Object.freeze({__proto__:null,RoktEvent:a,LauncherEvent:n,createLauncher:Ot,LauncherInstance:Pt,ServiceContainer:Rt,findFrames:_t,ErrorType:ct,PlacementInstance:dt,PlacementStream:ht,PlacementCollection:ut,Selection:vt,isBrowserSupported:Ct,ErrorMessage:Nt,hashString:Lt});const kt="GENERAL_ERROR",Dt=Object.assign(Object.assign({},n),{Failure:"FAILURE"});class Ut{constructor(e){this._placement=e}getAlias(){return this._placement.getAlias()}getElement(){return this._placement.getElement()}on(e){return x(this._placement.on(e))(U((e=>e.body)))}onClose(){return this._placement.onClose()}remove(){return this._placement.remove()}send(e,t){return this._placement.send(e,t)}}var Ft=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Mt{constructor(e,t,i,s,r,o,c,a,l){this._attributesService=e,this._configService=t,this._fulfillmentAttributesService=i,this._pageService=r,this._roktEventsService=o,this._selectionService=c,this._validationService=a,this.cart=l,this.roktConfiguration={},this._failureUnsubscriber=null,this._positiveEngagementCallback=null,this.RoktEventType=Dt,this.version="AL-4.2.0",s.then((e=>Ft(this,void 0,void 0,(function*(){e.on(n.SessionIdUpdated).subscribe((e=>{this.roktConfiguration.sessionId=e.body}))}))))}init(e){this._configService.set(e)}onLoaded(e){e(this)}on(e){return this._roktEventsService.on(e)}closeAll(){this._selectionService.clearSelection()}getPlacements(){return Ft(this,void 0,void 0,(function*(){const e=yield this._selectionService.getCurrentSelection();return e?e.placements.getAll().map((e=>new Ut(e))):[]}))}hashString(e){return Lt(e)}onFailure(e){this._failureUnsubscriber&&this._failureUnsubscriber.unsubscribe(),this._failureUnsubscriber=this._roktEventsService.on(Dt.Failure).subscribe(e)}onPositiveEngagement(e){this._positiveEngagementCallback||this._selectionService.onPositiveEngagement((()=>{this._positiveEngagementCallback()})),this._positiveEngagementCallback=e}setAttributes(e){this._selectionService.hasSelection()?this._selectionService.getCurrentSelection().then((t=>{t?t.setAttributes(e):this._attributesService.set(e)})):this._attributesService.set(e)}setFulfillmentAttributes(e){this._fulfillmentAttributesService.set(e)}triggerPageChange(e){this._pageService.changePage(e)}getValidationStatus(){return this._validationService.getValidationStatus()}}var jt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Gt{constructor(){this._attributes={},this._hasSetAttributes=!1}clear(){this._attributes={}}get(){return jt(this,void 0,void 0,(function*(){return this._attributes}))}hasSetAttributes(){return this._hasSetAttributes}set(e){return jt(this,void 0,void 0,(function*(){this._hasSetAttributes=!0,this._attributes=Object.assign(Object.assign({},this._attributes),e)}))}}var Vt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Wt{constructor(e){this._errorService=e,this._attributes={},this._rawAttributes={},this._hashingPending=Promise.resolve(),this._hasSetAttributes=!1}clear(){this._attributes={}}clearRaw(){this._rawAttributes={}}get(){return Vt(this,void 0,void 0,(function*(){return yield this._hashingPending,this._attributes}))}getRaw(){return this._rawAttributes}hasSetAttributes(){return this._hasSetAttributes}set(t){return Vt(this,void 0,void 0,(function*(){this._hasSetAttributes=!0;const i=this._hashingPending,n=new e;this._hashingPending=n.promise,yield i,this._rawAttributes=Object.assign(Object.assign({},this._rawAttributes),t),this._attributes=Object.assign(Object.assign({},this._attributes),yield this.hash(t)),n.resolve()}))}hash(e){return Vt(this,void 0,void 0,(function*(){const t={};try{const i=Object.entries(e).filter((([e,t])=>null!=t&&""!==t)).map((([e,i])=>Vt(this,void 0,void 0,(function*(){const n=`${e}sha256`,s=yield xt.hashString(String(i));t[n]=s}))));yield Promise.all(i)}catch(e){e.code="HASHING_FAILED",this._errorService.report(e)}return t}))}}class Bt{constructor(e,t){e.onSelectionComplete((e=>{const i=e.placements.on(a.UPDATE_CART_ITEM_MESSAGE).subscribe((e=>function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){if(this._callback)try{yield this._callback(e.body.cartItem,e.body.oldCartItem)}catch(e){throw e.code="CART_UPDATE_CALLBACK_FAILURE",e.severity=j,t.report(e),e}}))));return()=>i.unsubscribe()}))}onUpdateItem(e){this._callback=e}}var Ht=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class $t{constructor(t){this._optionsPromise=new e,this._options={skipPreload:!1},this.integrationType=this._getIntegrationType(),this.noDeviceId=this._get("noDeviceId"),this.noFunctional=this._get("noFunctional"),this.noTargeting=this._get("noTargeting"),this.doNotShareOrSell=this._get("doNotShareOrSell"),this.initialPageIdentifier=this._get("pageIdentifier"),this.initialPageLoadTimestamp=this._get("pageInitTimestamp"),this.sandbox=this._get("sandbox"),this.sessionId=this._get("sessionId"),this.skipInitialSelection=this._get("skipInitialSelection"),this.customHeaders=this._get("customHeaders"),this.skipPreload=this._get("skipPreload"),this.tagId=Promise.resolve(t.id),this.roktStartTimestamp=Promise.resolve(t.initTimestamp),this._init(t)}set(e){this._options=Object.assign(Object.assign({},this._options),e)}_init(e){return Ht(this,void 0,void 0,(function*(){yield e.onInitialised,this._optionsPromise.resolve(this._options)}))}_get(e){return Ht(this,void 0,void 0,(function*(){return(yield this._optionsPromise.promise)[e]}))}_getIntegrationType(){return Ht(this,void 0,void 0,(function*(){return((e,t,i)=>{if(null==e&&void 0!==i)return i;if(Object.values(t).includes(e))return e;throw new Error("ValueDoesNotExistInEnum")})(yield this._get("integrationType"),c,c.Default)}))}}var Kt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class zt{constructor(e,t,i){this._fallbackReporter=e;const n=i.getRoktObject();n&&"id"in n&&(this._tagId=n.id),this._init(t)}report(e){return Kt(this,void 0,void 0,(function*(){if(!e.handled)if(this._launcher)this._launcher.raiseError(e);else{const t={additionalInformation:e.additionalInformation,code:e.code,integration:"auto-launcher-2",message:e.message,name:e.name,reporter:e.reporter||"WSDK",severity:e.severity,stack:e.stack,tagId:this._tagId};this._fallbackReporter(t)}}))}_init(e){return Kt(this,void 0,void 0,(function*(){this._launcher=yield e}))}}var Yt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class qt{constructor(e,t,i,n,s){this._config=e,this._selectionService=t,this._attributesService=i,this._fulfillmentAttributesService=n,this._launcherPromise=s,this._selectionService.onSelectionComplete(this._getDisplayPlacementsCallback()),this._selectionService.onPositiveEngagement(this._getPositiveEngagementCallback())}initPage(){return Yt(this,void 0,void 0,(function*(){const e=yield this._config.initialPageIdentifier;yield this._performSelection(e)}))}changePage(e){return Yt(this,void 0,void 0,(function*(){this._selectionService.clearSelection(),this._selectionService.initialiseSelectionPromise(),(yield this._launcherPromise).changePage(e),yield this._performSelection(e.pageIdentifier)}))}_performSelection(e){return Yt(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},yield this._attributesService.get()),yield this._fulfillmentAttributesService.get());this._attributesService.clear(),this._fulfillmentAttributesService.clear(),yield this._selectionService.selectPlacements({pageIdentifier:e,attributes:t})}))}_getDisplayPlacementsCallback(){return e=>Yt(this,void 0,void 0,(function*(){try{yield e.placements.placeAll()}catch(e){}return()=>e.placements.removeAll()}))}_getPositiveEngagementCallback(){return e=>Yt(this,void 0,void 0,(function*(){const t=this._fulfillmentAttributesService.getRaw();this._fulfillmentAttributesService.clearRaw(),Object.keys(t).length&&(yield e.setAttributes(t))}))}}class Jt{constructor(e,t,i){this._launcherPromise=e,this._errorReporter=t,this._catchWrapSubscriber=i,this._events=new T,this._launcherFailureEvent=[n.AttributesCaptureFailure],this._initLauncherSubscription(),this._initLauncherFailuresMapping()}on(e){return this._catchWrapSubscriber(x(this._events)(k((t=>"*"===e||t.event===e)),U((t=>"*"===e?t:t.body))),(e=>{throw e.code="PARTNER_EVENT_CALLBACK_FAILURE",e.severity=j,this._errorReporter.report(e),e}))}triggerFailure(e){this._events.next({event:Dt.Failure,body:e})}_initLauncherSubscription(){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){try{const e=yield this._launcherPromise;x(e.on("*"))(U((e=>e))).subscribe(this._events)}catch(e){}}))}_initLauncherFailuresMapping(){x(this._events)(k((({event:e})=>this._launcherFailureEvent.includes(e))),U((()=>({event:Dt.Failure,body:kt})))).subscribe((e=>{this._events.next(e)}))}}var Xt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Zt{constructor(e){this._errorReporter=e,this._selectionCallbacks=[],this._teardownCallbacks=[],this._eventCallbacks=[]}onSelection(e){this._selectionCallbacks.push(this._wrapCallback("SELECTION_CALLBACK_FAILURE",e))}onEvent(e,t){this._eventCallbacks.push([e,this._wrapCallback(`${e}_EVENT_CALLBACK_FAILURE`,t)])}initializeSelection(e){this._teardownCallbacks=this._selectionCallbacks.map((t=>t(e))),this._subscribeSelectionEvents(e)}teardown(){return Xt(this,void 0,void 0,(function*(){const e=this._teardownCallbacks;this._teardownCallbacks=[],yield Promise.all(e.map((e=>Xt(this,void 0,void 0,(function*(){const t=yield e;if(t)return this._wrapCallback("TEARDOWN_CALLBACK_FAILURE",t)()})))))}))}_wrapCallback(e,t){return(...i)=>Xt(this,void 0,void 0,(function*(){try{return yield t(...i)}catch(t){throw t.code=e,this._errorReporter.report(t),t}}))}_subscribeSelectionEvents(e){const t=new E;this._eventCallbacks.forEach((([i,n])=>{t.add(e.placements.on(i).subscribe((()=>n(e))))})),this._teardownCallbacks.push((()=>{t.unsubscribe()}))}}class Qt{constructor(t,i,n,s){this._callbackContainer=t,this._errorService=i,this._eventsService=n,this._launcherPromise=s,this._selectionPromise=new e,this._hasSelection=!1,this._currentSelectionId=0}selectPlacements(e){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){const i=this._currentSelectionId=this._currentSelectionId+1;let n;this._hasSelection=!0;const s=yield this._launcherPromise;try{n=yield s.selectPlacements(e)}catch(e){if("SIMULTANEOUS_SELECTION"===e.code)return;throw this._hasSelection=!1,this._selectionPromise.resolve(null),e.code!==t&&(e.code="SELECTION_FAILURE"),e.severity=e.severity||M,this._errorService.report(e),this._eventsService.triggerFailure(kt),e}i===this._currentSelectionId&&this._selectionPromise.isPending()&&(this._callbackContainer.initializeSelection(n),this._hasSelection=!0,this._selectionPromise.resolve(n))}))}hasSelection(){return this._hasSelection}getCurrentSelection(){return this._selectionPromise.promise}initialiseSelectionPromise(){this._selectionPromise.isPending()&&this._selectionPromise.resolve(null),this._selectionPromise=new e}clearSelection(){this._selectionPromise.isFulfilled()&&(this._selectionPromise=new e),this._hasSelection=!1,0!==this._currentSelectionId&&this._selectionPromise.resolve(null),this._callbackContainer.teardown()}onSelectionComplete(e){this._callbackContainer.onSelection(e)}onPositiveEngagement(e){this._callbackContainer.onEvent(a.POSITIVE_ENGAGEMENT,e)}}class ei{constructor(t,i,n){this._globalAccessor=t,this._errorService=i,this._eventsService=n,this._initialisedPromise=new e;try{const e=this._globalAccessor.getRoktObject();if(!e)throw new G(S,{code:S,severity:j});if(!e.id)throw new G(b,{code:b,severity:j});this._snippet=e}catch(e){throw this._errorService.report(e),this._eventsService.triggerFailure(e.code===b?"NO_TAG_ID":"NO_SNIPPET"),e}}get id(){return this._snippet.id}get initTimestamp(){return this._snippet.it}get onInitialised(){return this._initialisedPromise.promise}initialise(e){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){try{this._globalAccessor.setRoktObject(e),yield Promise.all(this._snippet.lc.map((t=>t(e)))),this._initialisedPromise.resolve()}catch(e){throw e.code="ON_LOADED_CALLBACK",e.severity=j,this._errorService.report(e),this._eventsService.triggerFailure("ON_LOADED_CALLBACK_ERROR"),e}}))}}var ti=Object.freeze({__proto__:null,CartEvent:{UPDATE_CART_ITEM_MESSAGE:"UPDATE_CART_ITEM_MESSAGE",UPSERT_ALERT:"UPSERT_ALERT",DELETE_ALERT:"DELETE_ALERT",UPSERT_DELIVERY_DETAILS:"UPSERT_DELIVERY_DETAILS"}}),ii=Object.freeze({__proto__:null,PartnerMessage:{UpdateCartItem:"V2_UPDATE_CART_ITEM"},PlacementMessage:{CartItemUpdated:"V2_CART_ITEM_UPDATED"}}),ni=(Object.freeze({__proto__:null,V1:ti,V2:ii}),Object.freeze({__proto__:null,Extension:{PartnerValidation:"PartnerValidation"}}),Object.freeze({__proto__:null,PartnerValidationEvent:{SET_PARTNER_VALIDATION_STATUS:"SET_PARTNER_VALIDATION_STATUS",OPT_IN_TO_PARTNER_VALIDATION:"OPT_IN_TO_PARTNER_VALIDATION",SHOW_PARTNER_VALIDATION_STATUS:"SHOW_PARTNER_VALIDATION_STATUS"}}));class si{constructor(e){this._selectionService=e,this._selectionService.onSelectionComplete((e=>this._onSelection(e))),this._placementsValidationState=[]}getValidationStatus(){return function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){yield this._selectionService.getCurrentSelection();const e=((...e)=>new I((t=>{if(!e.length)return t.complete(),y;const i=new E,n=new Array(e.length),s=new Array(e.length),r=e=>!n.includes(void 0)&&t.next(e);for(let t=0;t<e.length;t++){const o=e[t].subscribe((e=>{s[t]=e,n[t]=!0,r(s)}));i.add(o)}return()=>i.unsubscribe()})))(...this._placementsValidationState),t=yield((e,t)=>{let i;const n="object"==typeof t;return new Promise(((s,r)=>{i=e.subscribe(s,r,(()=>{n?s(t.defaultValue):r(new Error("CompletedBeforeEmit"))}))})).finally((()=>i.unsubscribe()))})(e,{defaultValue:[]}),i={isValid:!0,placements:[]};for(const e of t)e.placement.send(ni.PartnerValidationEvent.SHOW_PARTNER_VALIDATION_STATUS),e.errors.length&&(i.isValid=!1,i.placements.push({element:e.placement.getElement(),errors:e.errors}));return i}))}_onSelection(e){e.placements.getAll().forEach((e=>{const t=new A(1),i=this._createPlacementValidationStream(e).subscribe(t);this._placementsValidationState.push(t),e.onClose().then((()=>{const e=this._placementsValidationState.indexOf(t);this._placementsValidationState.splice(e,1),i.unsubscribe()}))}))}_createPlacementValidationStream(e){return new I((t=>{const i=x(O(x(e.on(ni.PartnerValidationEvent.OPT_IN_TO_PARTNER_VALIDATION))(U((()=>!0))),x(e.on(a.DISPLAY_SETTINGS_SET))(U((()=>!1)))))(D()),n=x(i)(k((e=>!e)),U((()=>[]))),s=x(e.on(ni.PartnerValidationEvent.SET_PARTNER_VALIDATION_STATUS))(U((e=>e.body.errors))),r=x(O(n,s))(U((t=>({placement:e,errors:t})))).subscribe(t);return e.onClose().then((()=>{t.next({placement:e,errors:[]}),t.complete()})),()=>r.unsubscribe()}))}}new Date;const ri=new class{constructor(e){this._rootObject=e,this._key=this._rootObject._ROKT_}getRoktObject(){if(this._key)return this._rootObject[this._key]}setRoktObject(e){this._rootObject[this._key]=e}}(window);var oi,ci,ai;oi=(e,t)=>function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){const i=new zt(V.reportError,t,e),n=new Jt(t,i,C),s=new ei(e,i,n),r=new $t(s),o=((e,t,i,n)=>()=>function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){try{const i={integrationName:"auto-launcher-2",customHeaders:yield t.customHeaders,initTimestamp:yield t.roktStartTimestamp,integrationType:yield t.integrationType,integrationVersion:"AL-4.2.0",noDeviceId:yield t.noDeviceId,noFunctional:yield t.noFunctional,noTargeting:yield t.noTargeting,doNotShareOrSell:yield t.doNotShareOrSell,pageInitTimestamp:yield t.initialPageLoadTimestamp,sandbox:yield t.sandbox,sessionId:yield t.sessionId,skipPreload:yield t.skipPreload,tagId:yield t.tagId};return yield e(i)}catch(e){throw e.code="FAILED_TO_INITIALISE_LAUNCHER",i.report(e),n.triggerFailure(kt),e}})))(Ot,r,i,n),c=new Gt,a=new Wt(i),l=new Qt(new Zt(i),i,n,t),d=new qt(r,l,c,a,t),h=new si(l),u=new Bt(l,i);return{attributesService:c,fulfillmentAttributesService:a,configService:r,launcherFactory:o,rokt:new Mt(c,r,a,t,d,n,l,h,u),snippetService:s,selectionService:l,pageService:d}})),ci=ri,ai=function(e){if(Ct())return!0;const t=function(){const e="BROWSER_NOT_SUPPORTED";return{version:"0",RoktEventType:Dt,init:()=>{},onLoaded:()=>{},on:t=>({subscribe:(i,n,s)=>(i&&("*"===t?i({event:Dt.Failure,body:e}):t===Dt.Failure&&i(e),s&&s()),{unsubscribe:()=>{}})}),onFailure:t=>{t(e)},closeAll:()=>{},getPlacements:()=>Promise.resolve([]),hashString:()=>Promise.resolve(""),onPositiveEngagement:()=>{},setAttributes:()=>{},setFulfillmentAttributes:()=>{},triggerPageChange:()=>{},getValidationStatus:()=>Promise.resolve({isValid:!0,placements:[]}),cart:{onUpdateItem:()=>{}}}}(),i=e.getRoktObject();if(i)try{i.lc.forEach((e=>e(t)))}catch(e){}return!1},function(e,t,i,n){new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){var t;if(!ai(ci))return;if("function"==typeof(null===(t=ci.getRoktObject())||void 0===t?void 0:t.init))return;const i=new e,{configService:n,launcherFactory:s,pageService:r,rokt:o,snippetService:a,attributesService:l,fulfillmentAttributesService:d}=yield oi(ci,i.promise);yield a.initialise(o);const h=yield s();i.resolve(h),(yield n.skipInitialSelection)||(yield n.integrationType)===c.Preload||(yield r.initPage(),!l.hasSetAttributes()&&!d.hasSetAttributes()&&Math.random()<=.05&&(yield h.log({code:"ATTRIBUTES_NOT_SET"})))}))})()})();