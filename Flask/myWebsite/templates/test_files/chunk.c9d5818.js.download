(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{2190:function(e,t,r){"use strict";r.r(t),r.d(t,"LaunchDarklyService",(function(){return z}));r(27),r(26),r(23),r(30),r(31);var n=r(34),o=r(5),c=r(66),l=r(2),d=r(8),h=r(9),v=(r(25),r(28),r(10),r(50),r(22),r(2175)),f=r(107),y=r(40),O=r.n(y),j=r(39),k=r.n(j),w=r(571);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function F(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var z=function(){function e(t){var r=this,n=t.store,o=t.$braze,c=t.$heap;Object(d.a)(this,e),this.initialized=!1,this.failedToInitialize=!1,this.updatedFlags={},this.subscribers={},this.store=n,this.braze=o,this.heap=c,this.client=Object(v.a)("5c6b28dadb8ac42df4f22587",{anonymous:!0,custom:{appVersion:"4.86.0",system:"web_v2"}},{evaluationReasons:!0}),this.client.on("initialized",(function(){return r.initialized=!0})),this.client.on("change",this.updateFlags.bind(this)),this.client.on("failed",(function(){r.failedToInitialize=!0,Object(f.a)(new Error("failed to initialize LaunchDarkly client"),"launch-darkly-failed-initialization")}))}var t,r,o;return Object(h.a)(e,[{key:"getFeatureFlag",value:(o=Object(l.a)(regeneratorRuntime.mark((function e(t,r){var n,o,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient();case 2:return c=e.sent,l=c.variationDetail(t,r),d=l.value,this.setFlagToBraze(t,d),this.setFlagToHeap(t,d),this.updatedFlags[t]&&(d=this.updatedFlags[t].current),"ERROR"===(null===(n=null==l?void 0:l.reason)||void 0===n?void 0:n.kind)&&Object(f.a)(new Error("LaunchDarkly error when fetching flag: ".concat(t,"\nReason: ").concat(null!==(o=l.reason.errorKind)&&void 0!==o?o:"UNKNOWN")),"launch-darkly-failed-get-flags"),e.abrupt("return",null!=d?d:null);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"updateUser",value:(r=Object(l.a)(regeneratorRuntime.mark((function e(t,r){var n,o,c,l,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient();case 2:if(c=e.sent,l=t?"":O.a.getJSON("ibotta-test-group"),d=r||(null===(o=null===(n=O.a.getJSON("vuex"))||void 0===n?void 0:n.user)||void 0===o?void 0:o.joinDate)||Date.now(),h=t?{key:t,custom:{dateJoined:d,appVersion:"4.86.0",system:"web_v2"}}:!t&&l?{key:l,anonymous:!0,custom:{dateJoined:d,appVersion:"4.86.0",system:"web_v2"}}:{anonymous:!0,custom:{appVersion:"4.86.0",system:"web_v2"}},!this.failedToInitialize){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,c.identify(h);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),Object(f.a)(e.t0,"launch-darkly-failed-updated-user");case 16:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(e,t){return r.apply(this,arguments)})},{key:"setFlagToHeap",value:function(e,t){var r,n={};n[e]="object"===Object(c.a)(t)?!k()(t):t,null===(r=this.heap)||void 0===r||r.addEventProperties(n)}},{key:"setFlagToBraze",value:function(e,t){var r;null===(r=this.braze)||void 0===r||r.setCustomUserAttribute("flag_".concat(e),"object"===Object(c.a)(t)?!k()(t):t)}},{key:"setAllFlagsToBrazeAndHeap",value:function(){var e,t,r,n;for(var o in null===(t=null===(e=this.store)||void 0===e?void 0:e.state)||void 0===t?void 0:t.featureFlags){var c=w.a[o].flagName,l=null===(n=null===(r=this.store)||void 0===r?void 0:r.state)||void 0===n?void 0:n.featureFlags[o];this.setFlagToBraze(c,l),this.setFlagToHeap(c,l)}}},{key:"subscribe",value:function(e,t,r){this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push([t,r.toString()])}},{key:"updateFlags",value:function(e){var t=this;this.updatedFlags=F(F({},this.updatedFlags),e);var r=function(r){e[r]&&t.subscribers[r].forEach((function(t){var o=Object(n.a)(t,2);return o[0][o[1]]=e[r].current}))};for(var o in this.subscribers)r(o);for(var c in e){var l=this.updatedFlags[c].current;this.setFlagToBraze(c,l),this.setFlagToHeap(c,l)}}},{key:"getClient",value:(t=Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=12;break}return e.prev=1,e.next=4,this.client.waitForInitialization();case 4:this.initialized=!0,e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),this.initialized=!1,this.failedToInitialize=!0,Object(f.a)(e.t0,"launch-darkly-failed-get-client");case 12:return e.abrupt("return",this.client);case 13:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return t.apply(this,arguments)})}]),e}()}}]);